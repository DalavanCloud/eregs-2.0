<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>eRegs 2.0</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> eRegs 2.0</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Installation and Data Loading</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#eregs-20">eRegs 2.0</a></li>
                
                    <li><a class="toctree-l4" href="#getting-eregs">Getting eRegs</a></li>
                
                    <li><a class="toctree-l4" href="#installing-the-prerequisites">Installing the prerequisites</a></li>
                
                    <li><a class="toctree-l4" href="#loading-data">Loading data</a></li>
                
                    <li><a class="toctree-l4" href="#loading-diffs">Loading diffs</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="regml/">RegML</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="api/">API</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="pipeline/">End-to-end pipeline</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">eRegs 2.0</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Installation and Data Loading</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="eregs-20">eRegs 2.0</h1>
<p>This is the documentation for the new version of <a href="https://www.consumerfinance.gov/eregulations">eRegs</a>, the interface for reading the Bureau's regulatory documents. This document describes how to deploy eRegs, add and update content, and troubleshoot.</p>
<h2 id="getting-eregs">Getting eRegs</h2>
<p>eRegs can be checked out from the Github repository:</p>
<pre><code>git clone https://github.com/cfpb/eregs-2.0
cd eregs-2.0
pip install -r requirements.txt
</code></pre>
<p>The other thing you'll need is the <code>eregsip</code> repository, which contains some static content for branding. If you are inside the CFPB developer VPN, you know where you can find this repository, and if you're not, you'll have to go without. You can run the project without this repository, but some static assets will be missing.</p>
<h2 id="installing-the-prerequisites">Installing the prerequisites</h2>
<p>In addition to installing the various required Python modules, you will need to install and configure a MySQL database and an ElasticSearch instance. If you are developing on a Mac, you may be able to install both of these via <code>homebrew</code> like so:</p>
<pre><code>brew install mysql
brew install elasticsearch23
</code></pre>
<p>Note that you will need ElasticSearch 2.3, not one of the later versions, which do not work correctly with Haystack, the search interface between Django and a search backend. If you are not able to install ElasticSearch 2.3, it might have been removed from Homebrew, in which case you will have to download the binary yourself. You can get the ElasticSearch 2.3 binar <a href="https://www.elastic.co/downloads/past-releases/elasticsearch-2-3-0">here</a>.</p>
<p>Once you have MySQL installed, you'll need to configure it to match the <code>settings.py</code> file. This means creating the two databases, creating the appropriate users, and granting those users privileges on the databases. First, create two databases named <code>eregs</code> and <code>test_eregs</code>. Then, create the user <code>eregs</code> authenticated by the password <code>eregs</code>. Finally, grant the <code>eregs</code> user privileges by logging into MySQL as root (<code>mysql -u root</code>) and running the following commands:</p>
<pre><code>grant all privileges on eregs.* to 'eregs'@'localhost' identified by eregs
grant all privileges on eregs.* to 'test_eregs'@'localhost' identified by eregs
</code></pre>
<p>Once that's done, you should run <code>./manage.py migrate</code> to create the database and the model tables. You should also make sure that ElasticSearch is running.</p>
<h2 id="loading-data">Loading data</h2>
<p>In order to load data, you'll need to grab the repository that contains the RegML files. Wherever you want to have this data, do:</p>
<pre><code>git clone https://github.com/cfpb/regulations-xml
</code></pre>
<p>This repository has the following structure:</p>
<pre><code>images                     # images that are embedded in the regulations
notice/                    # change notices for each regulation
    1003/                  # reg C
        2012-31311.xml
        ...                # etc.
    1005/                  # reg E
        2012-01728.xml
        ...                # etc.
    ...                    # etc.
regulation/                # compiled regulations
    1003/                  # reg C
        2011-31712.xml     # initial version of the regulation
        2012-31311.xml     # result of applying first notice
        ...                # etc.
    ...                    # etc.
</code></pre>
<p>If you run <code>./manage.py runserver</code> and go to <code>localhost:8000</code>, you'll see that there is no content in eRegs. To load some content, run the following management command:</p>
<pre><code>./manage.py import_xml /path/to/regulations-xml/regulation/1003/2011-31712.xml
</code></pre>
<p>This will import the initial version of Regulation C into eRegs. If you refresh your view, you will now see Regulation C on the landing page. You should be able to navigate the regulation interface in the same way that you navigate the current production eRegs interface.</p>
<p>In order to get search to work, you'll need to build the index:</p>
<pre><code>./manage.py rebuild_index
</code></pre>
<p>This will build the ElasticSearch index for eRegs. In the future, you can update the index by running <code>./manage.py update_index</code>. You should now be able to search the eRegs regulatory text in the normal manner.</p>
<h2 id="loading-diffs">Loading diffs</h2>
<p>Diffs are a special form of content that indicate the difference between two versions of a regulation. It is important to note that diffs are <em>not</em> symmetric; in other words, if <em>X</em> and <em>Y</em> are versions of a single regulation, <code>diff(X, Y) != diff(Y, X)</code>. Therefore, right now, if you want to display bidirectional differences in regulatory content, you need to generate diffs in both directions. There's a command to do that:</p>
<pre><code>./manage.py import_diff /path/to/regulations-xml/regulation/regnumber/version1.xml /path/to/regulations-xml/regulation/regnumber/version2.xml
./manage.py import_diff /path/to/regulations-xml/regulation/regnumber/version2.xml /path/to/regulations-xml/regulation/regnumber/version1.xml
</code></pre>
<p>Here, <code>regnumber</code> is the part number of the regulation (e.g. 1003) and <code>version1</code> and <code>version2</code> are the document numbers of the respective versions. Make sure that <code>regnumber</code> is the same in both cases; you can of course generate a diff between two different part numbers, but that diff would make no sense. In the future, there will be a single management command that will generate the bidirectional diffs for you, but for the moment, you have to run it twice with the arguments swapped, as above, to have differences in both directions.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="regml/" class="btn btn-neutral float-right" title="RegML">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="regml/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2017-06-06 16:59:09.867977
-->
